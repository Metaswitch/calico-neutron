#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

%:
	dh $@  --with python2,sphinxdoc

override_dh_install:
	dh_install --fail-missing -X/usr/etc -X/usr/bin/neutron-hyperv-agent

override_dh_installinit:
	dh_installinit
	dh_installinit -pneutron-plugin-openvswitch-agent --no-start --name=neutron-ovs-cleanup

override_dh_auto_clean:
	dh_clean

override_dh_auto_test:
ifeq (,$(filter nocheck,$(DEB_BUILD_OPTIONS)))
       # Unpatch quantum configuration to fixup tests which conflict
       # with a core_plugin being set.
       patch -p1 -R < debian/patches/fix-neutron-configuration.patch
       # Set a reasonable level of concurrency
       ./run_tests.sh -N -P --concurrency=4
       # Patch configuration file after testing
       patch -p1 < debian/patches/fix-neutron-configuration.patch
endif

override_dh_sphinxdoc:
ifeq (,$(findstring nodocs, $(DEB_BUILD_OPTIONS)))
	 python setup.py build_sphinx
	 cp -rf doc/build/html $(CURDIR)/debian/neutron-doc/usr/share/doc/neutron-doc
	 dh_sphinxdoc -O--buildsystem=python_distutils
endif
